# WOS å»ºç­‘ç®¡ç†ç³»ç»Ÿå®ç°è®¡åˆ’

## é¡¹ç›®æ¦‚è¿°

åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„å»ºç­‘ç®¡ç†ç³»ç»Ÿï¼ŒåŒ…å«å·¦ä¾§å»ºç­‘åˆ—è¡¨ï¼ˆ40%ï¼‰å’Œå³ä¾§äº’åŠ¨åœ°å›¾ï¼ˆ60%ï¼‰ï¼Œæ”¯æŒè”ç›Ÿåˆ†é…ã€æ—¶é—´ç®¡ç†ï¼ˆUnixæ—¶é—´æˆ³ï¼‰ã€çŠ¶æ€è¿½è¸ªå’ŒåŒå‘äº’åŠ¨ã€‚

**å»ºç­‘æ•°é‡**ï¼šæ€»è®¡ 91 ä¸ªå»ºç­‘
- 12 ä¸ªå ¡å’ (Fortresses)
- 4 ä¸ªè¦å¡ (Citadels)
- 74 ä¸ªå·¥ç¨‹ç«™ (Engineering Stations) - **8 ç§å­ç±»å‹**
- 1 ä¸ªå¤ªé˜³åŸä¸­å¿ƒ (Sun City)

### æ ¸å¿ƒåŠŸèƒ½
1. **å·¦å³åˆ†æ å¸ƒå±€**ï¼šå»ºç­‘åˆ—è¡¨ (40%) + åœ°å›¾ (60%)ï¼Œ**å·¦ä¾§é¢æ¿å¯æŠ˜å ã€å¯ç¼©æ”¾**
2. **å»ºç­‘ç®¡ç†**ï¼š90 ä¸ªä¸»è¦å»ºç­‘ï¼ˆ12 Fortresses + 4 Citadels + 74 Engineering Stationsï¼‰çš„åˆ†ç±»æ˜¾ç¤ºã€è”ç›Ÿåˆ†é…ã€æ—¶é—´ç¼–è¾‘ã€çŠ¶æ€ç®¡ç†
3. **å·¥ç¨‹ç«™å­ç±»å‹**ï¼š8 ç§ï¼ˆConstruction 5ã€Gathering 8ã€Production 12ã€Tech 12ã€Weapons 5ã€Training 16ã€Defense 6ã€Expedition 10ï¼‰
4. **æ—¶é—´ç³»ç»Ÿ**ï¼šä½¿ç”¨ Unix æ—¶é—´æˆ³å­˜å‚¨ï¼Œæœ¬åœ°æ—¶åŒºæ˜¾ç¤º
5. **åŒå‘äº’åŠ¨**ï¼šåˆ—è¡¨ â†” åœ°å›¾ç‚¹å‡»è”åŠ¨ã€é«˜äº®ã€æ»šåŠ¨å®šä½
6. **é»˜è®¤è¯­è¨€**ï¼š**è‹±æ–‡ç•Œé¢**ï¼Œé¢„ç•™å¤šè¯­è¨€æ”¯æŒï¼ˆi18nï¼‰ä½œä¸ºåç»­æ‰©å±•
6. **æ•°æ®æŒä¹…åŒ–**ï¼šlocalStorage å­˜å‚¨æ‰€æœ‰æ•°æ®

### æ–°å¢éœ€æ±‚ï¼ˆåŸºäºæ¸¸æˆæˆªå›¾å’Œè¯´æ˜ï¼‰
6. **å·¥ç¨‹ç«™ä¿æŠ¤ç›¾æœºåˆ¶**ï¼šå é¢†å3å¤©ä¿æŠ¤æœŸï¼Œæ˜¾ç¤ºä¿æŠ¤ç›¾å›¾æ ‡å’Œå€’è®¡æ—¶
7. **å ¡å’/è¦å¡ç®¡ç†åˆ†æ´¾**ï¼šç®¡ç†å±‚åˆ†é…ç³»ç»Ÿï¼Œæ˜¾ç¤ºå¥–åŠ±ã€å›ºå®šå¼€å¯æ—¶é—´
8. **åœ°å›¾ç¼©æ”¾è”ç›Ÿæ˜¾ç¤º**ï¼šç¼©å°æ—¶æ˜¾ç¤ºè”ç›Ÿåç§°ï¼ˆå¦‚ "BaB"ï¼‰
9. **åœ°å›¾æ§åˆ¶åŠŸèƒ½**ï¼šå¿«é€Ÿå›åˆ°ä¸­å¿ƒç‚¹ï¼Œæ¢å¤åˆ°åˆå§‹ä½ç½®
10. **å¯¼èˆªæ è®¾è®¡**ï¼šé¡¶éƒ¨æˆ–ä¾§è¾¹å¯¼èˆªæ ï¼ŒæŒ‰å»ºç­‘ç±»å‹åˆ†ç±»æ˜¾ç¤º
11. **æ—¶é—´è‡ªåŠ¨æ’åº**ï¼šå»ºç­‘åˆ—è¡¨æŒ‰å¼€å¯æ—¶é—´å¿«æ…¢è‡ªåŠ¨æ’åº
12. **å·¦ä¾§é¢æ¿ç¼©æ”¾**ï¼šè°ƒæ•´åˆ—è¡¨å†…å®¹å¤§å°ï¼ˆå­—ä½“ã€å¡ç‰‡å°ºå¯¸ï¼‰

---

## ç”¨æˆ·å®¡æŸ¥äº‹é¡¹

> [!WARNING]
> **å‚è€ƒé¡¹ç›® - åŠ¡å¿…å‚è€ƒ**
> 
> å‚è€ƒé¡¹ç›®ï¼š[wos-interactive-map-lite](https://github.com/Krozac/wos-interactive-map-lite)
> 
> **è¯·åŠ¡å¿…å‚è€ƒæ­¤é¡¹ç›®çš„å®ç°æ–¹å¼**ï¼š
> - ä»£ç ç»“æ„å’Œç»„ä»¶è®¾è®¡
> - åœ°å›¾äº¤äº’å’Œæ§åˆ¶é€»è¾‘
> - UI/UX è®¾è®¡é£æ ¼
> - æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ
> 
> åŒæ—¶å‚è€ƒæœ¬é¡¹ç›®çš„ `index.html`ï¼Œä¸¤ä¸ªé¡µé¢è®¾è®¡åº”è¯¥å·®ä¸å¤šã€‚

> [!IMPORTANT]
> **åœ°å›¾èƒŒæ™¯å›¾ä½ç½®**
> 
> éœ€æ±‚æ–‡æ¡£ä¸­æåˆ°ä½¿ç”¨ `/mnt/project/map2.png` ä½œä¸ºåœ°å›¾èƒŒæ™¯ã€‚
> 
> è¯·ç¡®è®¤ï¼š
> 1. æ‚¨æ˜¯å¦æœ‰ `map2.png` æ–‡ä»¶ï¼Ÿ
> 2. æ–‡ä»¶åº”æ”¾åœ¨å“ªä¸ªç›®å½•ï¼ˆ`public/` æˆ– `world/`ï¼‰ï¼Ÿ
> 
> å¦‚æœæ²¡æœ‰èƒŒæ™¯å›¾ï¼Œå°†ä½¿ç”¨æ·±è‰²èƒŒæ™¯ + ç½‘æ ¼çº¿ä½œä¸ºæ›¿ä»£æ–¹æ¡ˆã€‚

> [!IMPORTANT]
> **æŠ€æœ¯æ ˆé€‰æ‹©**
> 
> åŸºäºéœ€æ±‚åˆ†æå’Œå‚è€ƒé¡¹ç›®ï¼Œè®¡åˆ’ä½¿ç”¨ï¼š
> - **å‰ç«¯æ¡†æ¶**: React + TypeScript
> - **åœ°å›¾æ¸²æŸ“**: HTML Canvas 2Dï¼ˆä¸å‚è€ƒé¡¹ç›®ä¸€è‡´ï¼‰
> - **é»˜è®¤è¯­è¨€**: English (è‹±æ–‡)
> - **å›½é™…åŒ–**: é¢„ç•™ i18n æ”¯æŒï¼Œåç»­å¯æ‰©å±•
> - **åŸå› **: 
>   - éœ€æ±‚ä¸­çš„ 2D é¡¶è§†å›¾ã€ç¼©æ”¾ã€å¹³ç§»ç”¨ Canvas æ›´ç®€å•é«˜æ•ˆ
>   - æ ‡è®°åŠ¨ç”»ï¼ˆè„‰åŠ¨ã€é—ªçƒï¼‰ç”¨ CSS + Canvas æ›´æ˜“å®ç°
>   - ä¸å‚è€ƒé¡¹ç›®ä¿æŒæŠ€æœ¯æ ˆä¸€è‡´

---

## æè®®çš„å˜æ›´

### æ ¸å¿ƒé¡µé¢æ–‡ä»¶

#### [NEW] [map.html](file:///d:/github/wos-manager/map.html)
åŸºäº `ranks.html` åˆ›å»ºï¼ŒåŒ…å«ï¼š
- æ·±è‰²ä¸»é¢˜é…è‰²ï¼ˆ#1a1a2e èƒŒæ™¯ï¼‰
- React å’Œç›¸å…³åº“çš„ importmap
- Tailwind CSS é…ç½®

#### [NEW] [map.tsx](file:///d:/github/wos-manager/map.tsx)
é¡µé¢å…¥å£ï¼š
```tsx
import { StrictMode } from 'react';
import { createRoot } from 'react-dom/client';
import BuildingManager from './src/pages/BuildingManager';

createRoot(document.getElementById('root')).render(
  <StrictMode>
    <BuildingManager />
  </StrictMode>
);
```

---

### ä¸»é¡µé¢ç»„ä»¶

#### [NEW] [src/pages/BuildingManager.tsx](file:///d:/github/wos-manager/src/pages/BuildingManager.tsx)
ä¸»é¡µé¢ç»„ä»¶ï¼ŒåŒ…å«å·¦å³åˆ†æ å¸ƒå±€ï¼š

**çŠ¶æ€ç®¡ç†**ï¼š
```typescript
const [buildings, setBuildings] = useState<Building[]>([]);
const [selectedBuilding, setSelectedBuilding] = useState<string|null>(null);
const [leftPanelCollapsed, setLeftPanelCollapsed] = useState(false);  // å·¦ä¾§é¢æ¿æŠ˜å çŠ¶æ€
const [leftPanelZoom, setLeftPanelZoom] = useState(1);  // æ–°å¢ï¼šå·¦ä¾§é¢æ¿ç¼©æ”¾çº§åˆ« (0.75 - 1.25)
const [filter, setFilter] = useState<FilterState>({
  buildingTypes: ['fortress', 'citadel', 'engineering_station'],
  alliances: [],
  statuses: []
});
```

**å¸ƒå±€ç»“æ„**ï¼š
```tsx
<div className="flex h-screen">
  {/* å·¦ä¾§é¢æ¿æŠ˜å æŒ‰é’® */}
  <button 
    onClick={() => setLeftPanelCollapsed(!leftPanelCollapsed)}
    className="fixed top-4 left-4 z-50 glass-panel p-2"
  >
    {leftPanelCollapsed ? 'â†’' : 'â†'}
  </button>
  
  {/* å·¦ä¾§é¢æ¿ï¼ˆå¯æŠ˜å ï¼‰ */}
  <div 
    className={`transition-all duration-300 ${
      leftPanelCollapsed ? 'w-0' : 'w-[40%]'
    }`}
  >
    {!leftPanelCollapsed && (
      <BuildingList 
        buildings={filteredBuildings}
        selectedId={selectedBuilding}
        onSelect={handleSelectFromList}
      />
    )}
  </div>
  
  {/* å³ä¾§åœ°å›¾ï¼ˆåŠ¨æ€å®½åº¦ï¼‰ */}
  <div className={`transition-all duration-300 ${
    leftPanelCollapsed ? 'w-full' : 'w-[60%]'
  }`}>
    <MapView 
      buildings={buildings}
      selectedId={selectedBuilding}
      onSelectMarker={handleSelectFromMap}
      zoom={mapZoom}
    />
  </div>
</div>
```

---

### é¡¶éƒ¨å¯¼èˆªæ 

#### [NEW] [src/components/BuildingNavBar.tsx](file:///d:/github/wos-manager/src/components/BuildingNavBar.tsx)
Top navigation bar, categorized by building type:
- **All Tab**: Show all 90 buildings
- **Fortresses Tab** (12): All fortresses
- **Citadels Tab** (4): All citadels  
- **Engineering Stations Tab** (74): Main tab + 8 sub-type dropdown
  - Construction Facility (5)
  - Gathering Facility (8)
  - Production Facility (12)
  - Tech Facility (12)
  - Weapons Facility (5)
  - Training Facility (16)
  - Defense Facility (6)
  - Expedition Facility (10)

**Design Style**:
- Horizontal tab bar, similar to tabs design
- Engineering Stations tab shows dropdown menu on hover with 8 sub-types
- Currently selected tab highlighted
- Each tab displays count badge (e.g., "Fortresses (12)")

---

### å·¦ä¾§åˆ—è¡¨ç»„ä»¶

#### [NEW] [src/components/BuildingList.tsx](file:///d:/github/wos-manager/src/components/BuildingList.tsx)
Left panel (40% width), contains:
- Top search and filter bar
- **Zoom Controller**: Adjust list content size (75% - 125%)
- **Auto-sort Toggle**: Sort by opening time (enabled by default)
- Three collapsible category sections (Fortresses, Citadels, Engineering Stations)
- Virtual scrolling for performance optimization

**Features**:
- Search: Real-time filter by building name/ID
- **ZoomåŠŸèƒ½**:
  - Zoom range: 75% - 125%
  - Affects font size, card dimensions, spacing
  - Zoom level saved to localStorage
  - ç¼©æ”¾æŒ‰é’®ï¼š+ / - / é‡ç½®
- **è‡ªåŠ¨æ’åº**ï¼šæŒ‰å¼€å¯æ—¶é—´ä»è¿‘åˆ°è¿œæ’åºï¼ˆå³å°†å¼€å¯çš„åœ¨å‰ï¼‰
- æ‰‹åŠ¨æ’åºï¼šå¯åˆ‡æ¢æŒ‰å¼€å¯æ—¶é—´ã€å…³é—­æ—¶é—´ã€è”ç›Ÿæ’åº
- è‡ªåŠ¨æ»šåŠ¨åˆ°é€‰ä¸­å»ºç­‘

#### [NEW] [src/components/BuildingCard.tsx](file:///d:/github/wos-manager/src/components/BuildingCard.tsx)
å•ä¸ªå»ºç­‘å¡ç‰‡ï¼Œ**æ ¹æ®å»ºç­‘ç±»å‹æ˜¾ç¤ºä¸åŒå†…å®¹**ï¼š

**å·¥ç¨‹ç«™å¡ç‰‡**ï¼š
- å»ºç­‘å›¾æ ‡ + åç§° + ç¼–å·ï¼ˆES01-ES74ï¼‰
- è”ç›Ÿä¸‹æ‹‰é€‰å•ï¼ˆå¯ç¼–è¾‘ï¼‰
- **ä¿æŠ¤ç›¾çŠ¶æ€**ï¼š
  - ä¿æŠ¤ä¸­ï¼šæ˜¾ç¤ºè“è‰²ä¿æŠ¤ç›¾å›¾æ ‡ + å‰©ä½™æ—¶é—´å€’è®¡æ—¶
  - å¼€å¯ä¸­ï¼šæ˜¾ç¤ºç»¿è‰²è„‰åŠ¨
  - æ—¶é—´æ ¼å¼ï¼š`ä¿æŠ¤ä¸­ - å‰©ä½™ 2å¤© 15å°æ—¶ 30åˆ†é’Ÿ`
- å¼€å¯æ—¶é—´ï¼ˆä¿æŠ¤æœŸç»“æŸæ—¶é—´ï¼Œå¯ç¼–è¾‘ï¼‰
- å¤‡æ³¨è¾“å…¥æ¡†
- "å®šä½åˆ°åœ°å›¾"æŒ‰é’®

**Fortresses/Citadels Card**:
- Building icon + Name + ID (F01-F12, C01-C04)
- **Fixed Opening Time Display** (not editable, game rules)
- **Reward Information Display**:
  - Fortress rewards (e.g., Rare Resource Box x2)
  - Citadel rewards (e.g., Epic Equipment Shard x5)
- **Alliance Assignment**: Dropdown to select alliance
- Notes input field

**å¡ç‰‡æ ·å¼**ï¼š
- glass-panel ç»ç’ƒæ€æ•ˆæœ
- é€‰ä¸­æ—¶é»„è‰²é«˜äº®
- æ‚¬åœæ—¶æ·»åŠ è¾¹æ¡†

#### [NEW] [src/components/TimeEditor.tsx](file:///d:/github/wos-manager/src/components/TimeEditor.tsx)
æ—¶é—´ç¼–è¾‘ç»„ä»¶ï¼ˆ**ä»…ç”¨äºå·¥ç¨‹ç«™**ï¼‰ï¼š
- æ˜¾ç¤ºæœ¬åœ°æ—¶åŒºæ—¶é—´ï¼ˆä½¿ç”¨ `Intl.DateTimeFormat`ï¼‰
- ç‚¹å‡»å¼¹å‡ºæ—¥æœŸæ—¶é—´é€‰æ‹©å™¨
- å¿«é€Ÿè°ƒæ•´æŒ‰é’®ï¼ˆ+1h, +6h, +12h, +1d, ç°åœ¨, æ˜å¤©ï¼‰
- è‡ªåŠ¨è½¬æ¢ä¸º Unix æ—¶é—´æˆ³å­˜å‚¨
- éªŒè¯é€»è¾‘ï¼ˆå¼€å¯ < å…³é—­ï¼‰

**ä¿æŠ¤ç›¾å€’è®¡æ—¶è®¡ç®—**ï¼š
```typescript
export function calculateProtectionRemaining(captureTime: number): string {
  const protectionEndTime = captureTime + (3 * 24 * 3600); // 3å¤©ä¿æŠ¤æœŸ
  const now = Math.floor(Date.now() / 1000);
  const remaining = protectionEndTime - now;
  
  if (remaining <= 0) {
    return 'ä¿æŠ¤å·²ç»“æŸ';
  }
  
  const days = Math.floor(remaining / 86400);
  const hours = Math.floor((remaining % 86400) / 3600);
  const minutes = Math.floor((remaining % 3600) / 60);
  
  return `ä¿æŠ¤ä¸­ - å‰©ä½™ ${days}å¤© ${hours}å°æ—¶ ${minutes}åˆ†é’Ÿ`;
}
```



#### [NEW] [src/components/CollapsibleSection.tsx](file:///d:/github/wos-manager/src/components/CollapsibleSection.tsx)
å¯æŠ˜å åˆ†ç±»åŒºå—ï¼š
- æ˜¾ç¤ºæ ‡é¢˜ + æ•°é‡ç»Ÿè®¡
- ç‚¹å‡»å±•å¼€/æŠ˜å 
- æ”¯æŒå¹³æ»‘åŠ¨ç”»è¿‡æ¸¡

---

### å³ä¾§åœ°å›¾ç»„ä»¶

#### [NEW] [src/components/MapView.tsx](file:///d:/github/wos-manager/src/components/MapView.tsx)
å³ä¾§åœ°å›¾é¢æ¿ï¼ˆå®½åº¦ 60%ï¼‰ï¼ŒåŒ…å«ï¼š
- Canvas åœ°å›¾æ¸²æŸ“
- ç¼©æ”¾æ§åˆ¶ï¼ˆ50% - 200%ï¼‰
- **ç¼©æ”¾çº§åˆ«è¿½è¸ª**ï¼ˆä¼ é€’ç»™æ¸²æŸ“å‡½æ•°ï¼‰
- **é‡ç½®æŒ‰é’®**ï¼šå¿«é€Ÿå›åˆ°ä¸­å¿ƒç‚¹ï¼Œæ¢å¤åˆå§‹ä½ç½®
- åœ°å›¾å›¾ä¾‹ï¼ˆå³ä¸‹è§’ï¼‰

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
```typescript
- ä½¿ç”¨ HTML Canvas 2D æ¸²æŸ“åœ°å›¾
- æ”¯æŒç¼©æ”¾ï¼ˆæ»šè½®ï¼‰å’Œå¹³ç§»ï¼ˆæ‹–æ‹½ï¼‰
- æ¸²æŸ“ 91 ä¸ªå»ºç­‘æ ‡è®°ï¼ˆä¸åŒå›¾æ ‡å’Œé¢œè‰²ï¼‰
- ç‚¹å‡»æ ‡è®°è§¦å‘é€‰ä¸­äº‹ä»¶
- æ ¹æ®ç¼©æ”¾çº§åˆ«è°ƒæ•´æ˜¾ç¤ºå†…å®¹ï¼ˆè”ç›Ÿåç§°æ˜¾ç¤ºé€»è¾‘ï¼‰
- é‡ç½®è§†å›¾ï¼šä¸€é”®å›åˆ°åœ°å›¾ä¸­å¿ƒï¼ˆ600, 600ï¼‰ï¼Œç¼©æ”¾æ¢å¤åˆ° 100%
```

#### [NEW] [src/hooks/useMapCanvas.ts](file:///d:/github/wos-manager/src/hooks/useMapCanvas.ts)
åœ°å›¾ Canvas ç®¡ç† Hookï¼š

**åŠŸèƒ½å®ç°**ï¼š
```typescript
export function useMapCanvas(
  canvasRef: RefObject<HTMLCanvasElement>,
  buildings: Building[],
  selectedId: string | null
) {
  const [zoom, setZoom] = useState(1);
  const [pan, setPan] = useState({ x: 0, y: 0 });
  
  // æ¸²æŸ“åœ°å›¾èƒŒæ™¯ï¼ˆmap2.png æˆ–çº¯è‰²ï¼‰
  useEffect(() => {
    drawMapBackground(ctx, zoom, pan);
  }, [zoom, pan]);
  
  // æ¸²æŸ“å»ºç­‘æ ‡è®°
  useEffect(() => {
    buildings.forEach(building => {
      drawBuildingMarker(ctx, building, selectedId, zoom); // ä¼ é€’zoom
    });
  }, [buildings, selectedId, zoom]);
  
  // å¤„ç†é¼ æ ‡äº‹ä»¶ï¼ˆç‚¹å‡»ã€æ‹–æ‹½ã€æ»šè½®ï¼‰
  useEffect(() => {
    canvas.addEventListener('click', handleClick);
    canvas.addEventListener('wheel', handleZoom);
    canvas.addEventListener('mousedown', handleDragStart);
  }, []);
}
```

#### [NEW] [src/utils/mapRenderer.ts](file:///d:/github/wos-manager/src/utils/mapRenderer.ts)
åœ°å›¾æ¸²æŸ“å·¥å…·å‡½æ•°ï¼š

**å»ºç­‘æ ‡è®°æ¸²æŸ“**ï¼ˆæ ¹æ®ç¼©æ”¾çº§åˆ«è°ƒæ•´ï¼‰ï¼š
```typescript
export function drawBuildingMarker(
  ctx: CanvasRenderingContext2D,
  building: Building,
  isSelected: boolean,
  zoom: number  // æ–°å¢ï¼šç¼©æ”¾çº§åˆ«
) {
  const { x, y } = building.coordinates;
  
  // æ ¹æ®å»ºç­‘ç±»å‹ç»˜åˆ¶å›¾æ ‡
  switch (building.type) {
    case 'fortress':
      drawSquare(ctx, x, y, 24, '#ef4444'); // çº¢è‰²æ–¹å½¢
      break;
    case 'citadel':
      drawHexagon(ctx, x, y, 28, '#a855f7'); // ç´«è‰²å…­è§’å½¢
      break;
    case 'engineering_station':
      drawCircle(ctx, x, y, 20, '#3b82f6'); // è“è‰²åœ†å½¢
      // å·¥ç¨‹ç«™ä¿æŠ¤ç›¾ç»˜åˆ¶
      if (building.protectionEndTime > Date.now() / 1000) {
        drawProtectionShield(ctx, x, y);
      }
      break;
  }
  
  // ç»˜åˆ¶è”ç›Ÿè¾¹æ¡†é¢œè‰²
  const allianceColor = getAllianceColor(building.alliance);
  drawBorder(ctx, x, y, allianceColor);
  
  // ç»˜åˆ¶çŠ¶æ€åŠ¨ç”»
  drawStatusAnimation(ctx, x, y, building.status);
  
  // å¦‚æœé€‰ä¸­ï¼Œç»˜åˆ¶é«˜äº®åœ†åœˆ
  if (isSelected) {
    drawHighlight(ctx, x, y);
  }
  
  // ç¼©æ”¾å°äº 70% æ—¶ï¼Œæ˜¾ç¤ºè”ç›Ÿåç§°ï¼ˆå ¡å’å’Œè¦å¡ï¼‰
  if (zoom < 0.7 && (building.type === 'fortress' || building.type === 'citadel')) {
    if (building.alliance !== 'unassigned') {
      drawAllianceLabel(ctx, x, y, building.allianceName); // å¦‚ "BaB"
    }
  }
}
```

**ä¿æŠ¤ç›¾å›¾æ ‡ç»˜åˆ¶**ï¼š
```typescript
export function drawProtectionShield(
  ctx: CanvasRenderingContext2D,
  x: number,
  y: number
) {
  // ç»˜åˆ¶è“è‰²åŠé€æ˜ä¿æŠ¤ç›¾
  ctx.save();
  ctx.globalAlpha = 0.6;
  ctx.fillStyle = '#3b82f6';
  ctx.strokeStyle = '#60a5fa';
  ctx.lineWidth = 2;
  
  // ç›¾ç‰Œå¤–å½¢ï¼ˆç®€åŒ–ç‰ˆï¼‰
  ctx.beginPath();
  ctx.arc(x, y, 15, 0, Math.PI * 2);
  ctx.fill();
  ctx.stroke();
  
  // ä¸­å¿ƒåå­—æ ‡è®°
  ctx.strokeStyle = '#ffffff';
  ctx.lineWidth = 3;
  ctx.beginPath();
  ctx.moveTo(x - 6, y);
  ctx.lineTo(x + 6, y);
  ctx.moveTo(x, y - 6);
  ctx.lineTo(x, y + 6);
  ctx.stroke();
  
  ctx.restore();
}
```

**è”ç›Ÿåç§°ç»˜åˆ¶**ï¼ˆç¼©å°æ—¶æ˜¾ç¤ºï¼‰ï¼š
```typescript
export function drawAllianceLabel(
  ctx: CanvasRenderingContext2D,
  x: number,
  y: number,
  allianceName: string  // å¦‚ "BaB"
) {
  ctx.save();
  ctx.font = 'bold 16px Inter, sans-serif';
  ctx.fillStyle = '#ffffff';
  ctx.strokeStyle = '#000000';
  ctx.lineWidth = 3;
  ctx.textAlign = 'center';
  ctx.textBaseline = 'bottom';
  
  // é»‘è‰²æè¾¹
  ctx.strokeText(allianceName, x, y - 20);
  // ç™½è‰²å¡«å……
  ctx.fillText(allianceName, x, y - 20);
  
  ctx.restore();
}
```

**çŠ¶æ€åŠ¨ç”»**ï¼š
```typescript
export function drawStatusAnimation(
  ctx: CanvasRenderingContext2D,
  x: number,
  y: number,
  status: BuildingStatus
) {
  const timestamp = Date.now();
  
  switch (status) {
    case 'protected':
      // è“è‰²ä¿æŠ¤ä¸­ï¼ˆå·²åœ¨ drawProtectionShield ä¸­å¤„ç†ï¼‰
      break;
      
    case 'opening':
      // ç»¿è‰²è„‰åŠ¨åŠ¨ç”»
      const pulseRadius = 20 + Math.sin(timestamp / 500) * 5;
      ctx.strokeStyle = '#10b981';
      ctx.arc(x, y, pulseRadius, 0, Math.PI * 2);
      ctx.stroke();
      break;
      
    case 'soon':
      // é»„è‰²é—ªçƒï¼ˆè·å¼€å¯ < 1å°æ—¶ï¼‰
      if (Math.floor(timestamp / 500) % 2) {
        ctx.fillStyle = '#fbbf24';
        ctx.fill();
      }
      break;
      
    case 'closing':
      // ç°è‰²åŠé€æ˜
      ctx.globalAlpha = 0.3;
      break;
      
    case 'contested':
      // çº¢è‰²è¾¹æ¡†åŠ è„‰åŠ¨
      ctx.strokeStyle = '#ef4444';
      ctx.lineWidth = 3;
      ctx.stroke();
      break;
  }
}
```

#### [NEW] [src/components/MapLegend.tsx](file:///d:/github/wos-manager/src/components/MapLegend.tsx)
åœ°å›¾å›¾ä¾‹ï¼ˆå³ä¸‹è§’ï¼‰ï¼š
- ä¸‰ç§å»ºç­‘ç±»å‹çš„å›¾æ ‡è¯´æ˜
- äº”ç§è”ç›Ÿçš„é¢œè‰²è¯´æ˜
- **æ–°å¢**ï¼šä¿æŠ¤ç›¾çŠ¶æ€è¯´æ˜
- å››ç§çŠ¶æ€çš„è§†è§‰è¡¨ç¤º

---

### æ•°æ®ç®¡ç†

#### [NEW] [src/types/Building.ts](file:///d:/github/wos-manager/src/types/Building.ts)
å»ºç­‘æ•°æ®ç±»å‹å®šä¹‰ï¼ˆ**æ›´æ–°**ï¼‰ï¼š
```typescript
export interface Building {
  id: string;                    // F01, C01, ES01
  name: string;                 // Fortress F01 or Gathering Facility ES01
  type: 'fortress' | 'citadel' | 'engineering_station';
  
  // Engineering Station subtype (Engineering Stations only)
  stationSubType?: 'construction' | 'gathering' | 'production' | 'tech' | 'weapons' | 'training' | 'defense' | 'expedition';
  
  alliance: Alliance;           // Unassigned | Alliance A-E
  allianceName?: string;        // Alliance abbreviation (e.g., "BaB")
  
  // Engineering Station specific fields
  captureTime?: number;         // Capture time (Unix timestamp)
  protectionEndTime?: number;   // Protection period end time
  openTime?: number;            // Engineering Station: opens after protection
  
  // Fortress/Citadel specific fields
  fixedOpenTime?: number;       // Fixed opening time (game rules)
  reward?: BuildingReward;      // Reward information
  
  coordinates: { x: number; y: number }; // 0-1200
  status: BuildingStatus;       // Calculated
  notes: string;                // Optional notes
}

// å·¥ç¨‹ç«™å­ç±»å‹ä¸­è‹±æ–‡æ˜ å°„
export const STATION_TYPE_NAMES = {
  'construction': 'å»ºè®¾è®¾æ–½',
  'gathering': 'é‡‡é›†è®¾æ–½',
  'production': 'ç”Ÿäº§è®¾æ–½',
  'tech': 'ç§‘æŠ€è®¾æ–½',
  'weapons': 'æ­¦å™¨è®¾æ–½',
  'training': 'è®­ç»ƒè®¾æ–½',
  'defense': 'é˜²å¾¡è®¾æ–½',
  'expedition': 'è¿œå¾è®¾æ–½'
} as const;

export interface BuildingReward {
  type: string;                 // å¥–åŠ±ç±»å‹
  name: string;                 // å¥–åŠ±åç§°
  quantity: number;             // æ•°é‡
  icon?: string;                // å›¾æ ‡URLï¼ˆå¯é€‰ï¼‰
}

export type Alliance = 'unassigned' | 'allianceA' | 'allianceB' | 'allianceC' | 'allianceD' | 'allianceE';

export type BuildingStatus = 'protected' | 'opening' | 'soon' | 'closing' | 'contested';

export function calculateStatus(building: Building): BuildingStatus {
  const now = Math.floor(Date.now() / 1000);
  const oneHour = 3600;
  
  // å·¥ç¨‹ç«™ç‰¹æ®Šé€»è¾‘
  if (building.type === 'engineering_station') {
    if (building.protectionEndTime && now < building.protectionEndTime) {
      return 'protected';  // ä¿æŠ¤ä¸­
    }
    if (building.openTime) {
      if (now >= building.openTime) {
        return 'opening';  // å¼€å¯ä¸­
      }
      if (building.openTime - now <= oneHour) {
        return 'soon';  // å³å°†å¼€å¯
      }
    }
    return 'closing';
  }
  
  // å ¡å’/è¦å¡é€»è¾‘
  if (building.fixedOpenTime) {
    if (now >= building.fixedOpenTime) {
      return 'opening';
    }
    if (building.fixedOpenTime - now <= oneHour) {
      return 'soon';
    }
  }
  
  return 'closing';
}
```

#### [NEW] [src/utils/dataGenerator.ts](file:///d:/github/wos-manager/src/utils/dataGenerator.ts)
åˆå§‹æ•°æ®ç”Ÿæˆå™¨ï¼ˆ**æ›´æ–°**ï¼‰ï¼š
```typescript
export function generateInitialBuildings(): Building[] {
  const buildings: Building[] = [];
  const now = Math.floor(Date.now() / 1000);
  
  // ä» world/corrected_map_data.json åŠ è½½åæ ‡
  const worldData = loadWorldData();
  
  // ç”Ÿæˆ 12 ä¸ªå ¡å’ï¼ˆå›ºå®šå¼€å¯æ—¶é—´ï¼‰
  const fortressRewards = [
    { type: 'resource', name: 'ç¨€æœ‰èµ„æºç®±', quantity: 2 },
    { type: 'material', name: 'å»ºç­‘ææ–™åŒ…', quantity: 3 }
  ];
  
  worldData.fortresses.forEach((f, i) => {
    buildings.push({
      id: `F${String(i + 1).padStart(2, '0')}`,
      name: `å ¡å’ F${String(i + 1).padStart(2, '0')}`,
      type: 'fortress',
      alliance: 'unassigned',
      fixedOpenTime: getNextFortressOpenTime(),  // æ¸¸æˆå›ºå®šè§„åˆ™
      reward: fortressRewards[i % fortressRewards.length],
      coordinates: { x: f.x, y: f.y },
      status: 'closing',
      notes: ''
    });
  });
  
  // ç”Ÿæˆ 4 ä¸ªè¦å¡ï¼ˆå›ºå®šå¼€å¯æ—¶é—´ï¼‰
  const citadelRewards = [
    { type: 'equipment', name: 'å²è¯—è£…å¤‡ç¢ç‰‡', quantity: 5 },
    { type: 'hero', name: 'è‹±é›„ç»éªŒä¹¦', quantity: 10 }
  ];
  
  worldData.citadels.forEach((c, i) => {
    buildings.push({
      id: `C${String(i + 1).padStart(2, '0')}`,
      name: `è¦å¡ C${String(i + 1).padStart(2, '0')}`,
      type: 'citadel',
      alliance: 'unassigned',
      fixedOpenTime: getNextCitadelOpenTime(),
      reward: citadelRewards[i % citadelRewards.length],
      coordinates: { x: c.x, y: c.y },
      status: 'closing',
      notes: ''
    });
  });
  
  // å·¥ç¨‹ç«™å­ç±»å‹æ˜ å°„ï¼ˆä¸­æ–‡åç§° -> è‹±æ–‡keyï¼‰
  const stationTypeMap = {
    'å»ºè®¾è®¾æ–½': 'construction',
    'é‡‡é›†è®¾æ–½': 'gathering',
    'ç”Ÿäº§è®¾æ–½': 'production',
    'ç§‘æŠ€è®¾æ–½': 'tech',
    'æ­¦å™¨è®¾æ–½': 'weapons',
    'è®­ç»ƒè®¾æ–½': 'training',
    'é˜²å¾¡è®¾æ–½': 'defense',
    'è¿œå¾è®¾æ–½': 'expedition'
  };
  
  // ç”Ÿæˆ 74 ä¸ªå·¥ç¨‹ç«™ï¼ˆä¿æŠ¤ç›¾æœºåˆ¶ + å­ç±»å‹ï¼‰
  worldData.engineering_stations.forEach((e, i) => {
    const captureTime = now - randomInt(0, 172800);  // 0-2å¤©å‰å é¢†
    const protectionEndTime = captureTime + (3 * 24 * 3600);  // 3å¤©ä¿æŠ¤æœŸ
    
    buildings.push({
      id: `ES${String(i + 1).padStart(2, '0')}`,
      name: `å·¥ç¨‹ç«™ ES${String(i + 1).padStart(2, '0')}`,
      type: 'engineering_station',
      alliance: 'unassigned',
      captureTime,
      protectionEndTime,
      openTime: protectionEndTime,  // ä¿æŠ¤æœŸç»“æŸå³å¼€å¯
      coordinates: { x: e.x, y: e.y },
      status: 'protected',
      notes: ''
    });
  });
  
  return buildings;
}

// å ¡å’å›ºå®šå¼€å¯æ—¶é—´è§„åˆ™ï¼ˆç¤ºä¾‹ï¼šæ¯å‘¨ä¸€ã€ä¸‰ã€äº” 20:00ï¼‰
function getNextFortressOpenTime(): number {
  // å®ç°æ¸¸æˆè§„åˆ™çš„å›ºå®šæ—¶é—´é€»è¾‘
  // è¿™é‡Œéœ€è¦æ ¹æ®å®é™…æ¸¸æˆè§„åˆ™å®ç°
  return Math.floor(Date.now() / 1000) + 86400;  // ç¤ºä¾‹ï¼šæ˜å¤©
}

// è¦å¡å›ºå®šå¼€å¯æ—¶é—´è§„åˆ™ï¼ˆç¤ºä¾‹ï¼šæ¯å‘¨äºŒã€å››ã€å…­ 21:00ï¼‰
function getNextCitadelOpenTime(): number {
  return Math.floor(Date.now() / 1000) + 86400;  // ç¤ºä¾‹ï¼šæ˜å¤©
}
```

#### [NEW] [src/hooks/useLocalStorage.ts](file:///d:/github/wos-manager/src/hooks/useLocalStorage.ts)
localStorage æ•°æ®æŒä¹…åŒ– Hookï¼š
```typescript
export function useLocalStorage<T>(key: string, initialValue: T) {
  const [value, setValue] = useState<T>(() => {
    const stored = localStorage.getItem(key);
    return stored ? JSON.parse(stored) : initialValue;
  });
  
  useEffect(() => {
    localStorage.setItem(key, JSON.stringify(value));
  }, [key, value]);
  
  return [value, setValue] as const;
}
```

---

### åŒå‘äº’åŠ¨é€»è¾‘

#### [NEW] [src/hooks/useInteraction.ts](file:///d:/github/wos-manager/src/hooks/useInteraction.ts)
åŒå‘äº’åŠ¨ç®¡ç† Hookï¼š

**ä»åˆ—è¡¨åˆ°åœ°å›¾**ï¼š
```typescript
export function handleSelectFromList(buildingId: string) {
  // 1. è®¾ç½®é€‰ä¸­çŠ¶æ€
  setSelectedBuilding(buildingId);
  
  // 2. åœ°å›¾å¹³ç§»åˆ°å»ºç­‘ä½ç½®
  const building = buildings.find(b => b.id === buildingId);
  panMapToBuilding(building);
  
  // 3. æ”¾å¤§æ ‡è®°å¹¶æ·»åŠ é«˜äº®
  highlightMarker(buildingId);
  
  // 4. é™ä½å…¶ä»–æ ‡è®°ä¸é€æ˜åº¦è‡³ 30%
  dimOtherMarkers(buildingId);
  
  // 5. æ˜¾ç¤ºè¯¦æƒ…æµ®çª—ï¼Œ3ç§’åè‡ªåŠ¨æ¶ˆå¤±
  showBuildingPopup(building, 3000);
}
```

**ä»åœ°å›¾åˆ°åˆ—è¡¨**ï¼š
```typescript
export function handleSelectFromMap(buildingId: string) {
  // 1. è®¾ç½®é€‰ä¸­çŠ¶æ€
  setSelectedBuilding(buildingId);
  
  // 2. åˆ—è¡¨æ»šåŠ¨åˆ°è¯¥å»ºç­‘å¡ç‰‡
  scrollToCard(buildingId);
  
  // 3. å¡ç‰‡èƒŒæ™¯é«˜äº®ï¼ˆé»„è‰²ï¼Œ2ç§’ï¼‰
  highlightCard(buildingId, 2000);
  
  // 4. å¦‚æœæ‰€å±åˆ†ç±»æŠ˜å ï¼Œè‡ªåŠ¨å±•å¼€
  expandCategory(building.type);
  
  // 5. åœ°å›¾æ ‡è®°æ·»åŠ è„‰åŠ¨æ•ˆæœï¼ˆ2ç§’ï¼‰
  pulseMarker(buildingId, 2000);
}
```

**æ‚¬åœæ•ˆæœ**ï¼š
```typescript
export function handleHoverList(buildingId: string | null) {
  // é¼ æ ‡æ‚¬åœåˆ—è¡¨å¡ç‰‡ â†’ åœ°å›¾æ ‡è®°æ·»åŠ ç™½è‰²è¾¹æ¡†
  setHoveredBuilding(buildingId);
}

export function handleHoverMap(buildingId: string | null) {
  // é¼ æ ‡æ‚¬åœåœ°å›¾æ ‡è®° â†’ æ˜¾ç¤ºå·¥å…·æç¤ºï¼ˆåç§°+ç¼–å·ï¼‰
  setTooltip(buildingId ? getBuildingTooltip(buildingId) : null);
}
```

---

### æ ·å¼æ–‡ä»¶

#### [NEW] [src/styles/buildingManager.css](file:///d:/github/wos-manager/src/styles/buildingManager.css)
ä¸»æ ·å¼æ–‡ä»¶ï¼š

**é…è‰²æ–¹æ¡ˆ**ï¼š
```css
:root {
  --bg-primary: #1a1a2e;
  --bg-secondary: #16213e;
  --text-primary: #ffffff;
  --text-secondary: #94a3b8;
  --accent: #00d4ff;
  
  --alliance-unassigned: #6b7280;
  --alliance-a: #ef4444;
  --alliance-b: #3b82f6;
  --alliance-c: #10b981;
  --alliance-d: #fbbf24;
  --alliance-e: #a855f7;
  
  --status-protected: #3b82f6;    /* æ–°å¢ï¼šä¿æŠ¤ä¸­ */
  --status-opening: #10b981;
  --status-soon: #fbbf24;
  --status-closing: #6b7280;
  --status-contested: #ef4444;
}
```

**ç»ç’ƒæ€æ•ˆæœ**ï¼š
```css
.glass-panel {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(12px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
}
```

**åŠ¨ç”»**ï¼š
```css
@keyframes pulse {
  0%, 100% { transform: scale(1); opacity: 1; }
  50% { transform: scale(1.1); opacity: 0.8; }
}

@keyframes blink {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.3; }
}

@keyframes shield-glow {
  0%, 100% { box-shadow: 0 0 5px var(--status-protected); }
  50% { box-shadow: 0 0 15px var(--status-protected); }
}

.status-protected { animation: shield-glow 2s infinite; }
.status-opening { animation: pulse 2s infinite; }
.status-soon { animation: blink 1s infinite; }
```

---

### é…ç½®æ›´æ–°

#### [MODIFY] [vite.config.ts](file:///d:/github/wos-manager/vite.config.ts)
æ·»åŠ å¤šé¡µé¢æ”¯æŒï¼š
```typescript
export default defineConfig({
  build: {
    rollupOptions: {
      input: {
        main: resolve(__dirname, 'index.html'),
        ranks: resolve(__dirname, 'ranks.html'),
        map: resolve(__dirname, 'map.html'),
      }
    }
  }
});
```

---

## éªŒè¯è®¡åˆ’

### åŠŸèƒ½éªŒè¯æ¸…å•

**å¸ƒå±€å’Œæ˜¾ç¤º**ï¼š
- [ ] å·¦ä¾§é¢æ¿å  40% å®½åº¦
- [ ] å³ä¾§åœ°å›¾å  60% å®½åº¦
- [ ] 91 ä¸ªå»ºç­‘åˆ†ä¸‰ç±»æ˜¾ç¤ºï¼ˆ12+5+74ï¼‰
- [ ] æ¯ä¸ªå»ºç­‘å¡ç‰‡æ˜¾ç¤ºæ‰€æœ‰å¿…éœ€ä¿¡æ¯

**å·¥ç¨‹ç«™ç‰¹æœ‰åŠŸèƒ½**ï¼š
- [ ] ä¿æŠ¤ç›¾å›¾æ ‡æ­£ç¡®æ˜¾ç¤º
- [ ] å€’è®¡æ—¶å‡†ç¡®è®¡ç®—å¹¶å®æ—¶æ›´æ–°
- [ ] ä¿æŠ¤æœŸç»“æŸè‡ªåŠ¨åˆ‡æ¢çŠ¶æ€
- [ ] å¼€å¯æ—¶é—´å¯ç¼–è¾‘

**å ¡å’/è¦å¡ç‰¹æœ‰åŠŸèƒ½**ï¼š
- [ ] å›ºå®šå¼€å¯æ—¶é—´æ­£ç¡®æ˜¾ç¤ºï¼ˆä¸å¯ç¼–è¾‘ï¼‰
- [ ] å¥–åŠ±ä¿¡æ¯æ­£ç¡®æ˜¾ç¤º
- [ ] ç®¡ç†å‘˜åˆ†é…ç•Œé¢æ­£å¸¸å·¥ä½œ
- [ ] åˆ†é…å†å²æ­£ç¡®è®°å½•

**åœ°å›¾ç¼©æ”¾åŠŸèƒ½**ï¼š
- [ ] ç¼©å°è‡³ < 70% æ—¶æ˜¾ç¤ºè”ç›Ÿåç§°
- [ ] è”ç›Ÿåç§°æ­£ç¡®æ˜¾ç¤ºï¼ˆå¦‚ "BaB"ï¼‰
- [ ] ç¼©æ”¾è¿‡æ¸¡å¹³æ»‘

**æ—¶é—´ç®¡ç†**ï¼š
- [ ] æ—¶é—´ä»¥æœ¬åœ°æ—¶åŒºæ­£ç¡®æ˜¾ç¤º
- [ ] ç‚¹å‡»æ—¶é—´å¼¹å‡ºç¼–è¾‘å™¨ï¼ˆä»…å·¥ç¨‹ç«™ï¼‰
- [ ] å¿«é€Ÿè°ƒæ•´æŒ‰é’®æ­£å¸¸å·¥ä½œ
- [ ] Unix æ—¶é—´æˆ³æ­£ç¡®å­˜å‚¨

**åœ°å›¾åŠŸèƒ½**ï¼š
- [ ] åœ°å›¾èƒŒæ™¯æ­£ç¡®æ˜¾ç¤ºï¼ˆmap2.png æˆ–çº¯è‰²ï¼‰
- [ ] 91 ä¸ªæ ‡è®°ä½ç½®æ­£ç¡®
- [ ] ä¸‰ç§å»ºç­‘å›¾æ ‡æ­£ç¡®åŒºåˆ†
- [ ] ç¼©æ”¾åŠŸèƒ½ï¼ˆ50%-200%ï¼‰æ­£å¸¸
- [ ] å¹³ç§»åŠŸèƒ½æ­£å¸¸

**è”ç›Ÿå’ŒçŠ¶æ€**ï¼š
- [ ] è”ç›Ÿä¸‹æ‹‰é€‰å•å¯ç¼–è¾‘
- [ ] è”ç›Ÿè¾¹æ¡†é¢œè‰²æ­£ç¡®
- [ ] çŠ¶æ€è‡ªåŠ¨è®¡ç®—æ­£ç¡®
- [ ] çŠ¶æ€åŠ¨ç”»æ­£å¸¸ï¼ˆä¿æŠ¤ç›¾ã€è„‰åŠ¨ã€é—ªçƒï¼‰

**åŒå‘äº’åŠ¨**ï¼š
- [ ] åˆ—è¡¨ç‚¹å‡» â†’ åœ°å›¾å®šä½æ­£ç¡®
- [ ] åœ°å›¾ç‚¹å‡» â†’ åˆ—è¡¨æ»šåŠ¨æ­£ç¡®
- [ ] é€‰ä¸­æ—¶é«˜äº®æ•ˆæœæ­£ç¡®
- [ ] æ‚¬åœæ—¶å·¥å…·æç¤ºæ˜¾ç¤º
- [ ] æŠ˜å åˆ†ç±»è‡ªåŠ¨å±•å¼€

**æƒé™ç®¡ç†**ï¼š
- [ ] ç®¡ç†å‘˜åˆ‡æ¢æŒ‰é’®æ­£å¸¸å·¥ä½œ
- [ ] ç®¡ç†å‘˜ç•Œé¢æ­£ç¡®æ˜¾ç¤º/éšè—
- [ ] æ™®é€šç”¨æˆ·æ— æ³•è®¿é—®åˆ†é…åŠŸèƒ½

**æ•°æ®æŒä¹…åŒ–**ï¼š
- [ ] localStorage æ­£ç¡®å­˜å‚¨æ•°æ®
- [ ] é¡µé¢åˆ·æ–°åæ•°æ®æ¢å¤
- [ ] ä¿®æ”¹åè‡ªåŠ¨ä¿å­˜

### æ€§èƒ½æµ‹è¯•
- [ ] 91 ä¸ªå»ºç­‘æ¸²æŸ“æµç•…ï¼ˆ60fpsï¼‰
- [ ] è™šæ‹Ÿæ»šåŠ¨ä¼˜åŒ–åˆ—è¡¨æ€§èƒ½
- [ ] Canvas åŠ¨ç”»ä¸å¡é¡¿
- [ ] å€’è®¡æ—¶æ›´æ–°ä¸å½±å“æ€§èƒ½

### æµè§ˆå™¨å…¼å®¹æ€§
- [ ] Chrome æ­£å¸¸è¿è¡Œ
- [ ] Firefox æ­£å¸¸è¿è¡Œ
- [ ] Safari æ­£å¸¸è¿è¡Œ
- [ ] Edge æ­£å¸¸è¿è¡Œ

---

## å®ç°é¡ºåº

### é˜¶æ®µ 1ï¼šåŸºç¡€æ¶æ„ï¼ˆ3-4å°æ—¶ï¼‰
1. åˆ›å»º `map.html` å’Œ `map.tsx`
2. åˆ›å»º `BuildingManager.tsx` ä¸»é¡µé¢
3. å®šä¹‰ TypeScript ç±»å‹ï¼ˆ`Building.ts`ï¼ŒåŒ…å«æ–°å­—æ®µï¼‰
4. å®ç°æ•°æ®ç”Ÿæˆå™¨ï¼ˆæ•´åˆ world æ•°æ®ï¼ŒåŒºåˆ†å»ºç­‘ç±»å‹ï¼‰
5. å®ç° localStorage Hook

### é˜¶æ®µ 2ï¼šå·¦ä¾§åˆ—è¡¨ï¼ˆ5-6å°æ—¶ï¼‰
1. åˆ›å»º `BuildingList.tsx`
2. åˆ›å»º `BuildingCard.tsx`ï¼ˆåŒºåˆ†å·¥ç¨‹ç«™å’Œå ¡å’/è¦å¡ï¼‰
3. åˆ›å»º `TimeEditor.tsx`ï¼ˆå·¥ç¨‹ç«™ä¸“ç”¨ï¼‰
4. åˆ›å»º `AssignmentPanel.tsx`ï¼ˆå ¡å’/è¦å¡ç®¡ç†ï¼‰
5. åˆ›å»º `CollapsibleSection.tsx`
6. å®ç°æœç´¢å’Œæ’åºåŠŸèƒ½
7. åº”ç”¨ glass-panel æ ·å¼

### é˜¶æ®µ 3ï¼šå³ä¾§åœ°å›¾ï¼ˆ6-7å°æ—¶ï¼‰
1. åˆ›å»º `MapView.tsx`
2. å®ç° `useMapCanvas` Hook
3. å®ç° `mapRenderer.ts` æ¸²æŸ“å‡½æ•°
4. å®ç°å»ºç­‘æ ‡è®°ç»˜åˆ¶ï¼ˆå›¾æ ‡ã€è¾¹æ¡†ã€åŠ¨ç”»ï¼‰
5. **å®ç°ä¿æŠ¤ç›¾ç»˜åˆ¶**
6. **å®ç°è”ç›Ÿåç§°æ˜¾ç¤ºï¼ˆç¼©æ”¾é€»è¾‘ï¼‰**
7. å®ç°ç¼©æ”¾å’Œå¹³ç§»äº¤äº’
8. åˆ›å»º `MapLegend.tsx`

### é˜¶æ®µ 4ï¼šç‰¹æ®ŠåŠŸèƒ½ï¼ˆ3-4å°æ—¶ï¼‰
1. å®ç°å·¥ç¨‹ç«™ä¿æŠ¤ç›¾å€’è®¡æ—¶
2. å®ç°å ¡å’/è¦å¡å›ºå®šæ—¶é—´é€»è¾‘
3. å®ç°ç®¡ç†å‘˜åˆ†é…ç³»ç»Ÿ
4. å®ç°å¥–åŠ±ä¿¡æ¯æ˜¾ç¤º
5. å®ç°æƒé™ç®¡ç†

### é˜¶æ®µ 5ï¼šåŒå‘äº’åŠ¨ï¼ˆ2-3å°æ—¶ï¼‰
1. å®ç° `useInteraction` Hook
2. åˆ—è¡¨ â†’ åœ°å›¾è”åŠ¨
3. åœ°å›¾ â†’ åˆ—è¡¨è”åŠ¨
4. æ‚¬åœæ•ˆæœ
5. é«˜äº®å’ŒåŠ¨ç”»æ•ˆæœ

### é˜¶æ®µ 6ï¼šæ ·å¼å’Œä¼˜åŒ–ï¼ˆ2å°æ—¶ï¼‰
1. å®Œå–„ `buildingManager.css`
2. æ·»åŠ åŠ¨ç”»å’Œè¿‡æ¸¡æ•ˆæœ
3. å“åº”å¼è°ƒæ•´ï¼ˆè™½ç„¶ä¸»è¦é’ˆå¯¹æ¡Œé¢ç«¯ï¼‰
4. æ€§èƒ½ä¼˜åŒ–

### é˜¶æ®µ 7ï¼šæµ‹è¯•å’Œè°ƒè¯•ï¼ˆ2-3å°æ—¶ï¼‰
1. åŠŸèƒ½æµ‹è¯•ï¼ˆæ‰€æœ‰å»ºç­‘ç±»å‹ï¼‰
2. æ—¶é—´ç³»ç»Ÿæµ‹è¯•ï¼ˆå€’è®¡æ—¶ã€å›ºå®šæ—¶é—´ï¼‰
3. æƒé™æµ‹è¯•
4. æ€§èƒ½æµ‹è¯•
5. è·¨æµè§ˆå™¨æµ‹è¯•
6. Bug ä¿®å¤

---

## æŠ€æœ¯è¦ç‚¹

### æ—¶é—´å¤„ç†æœ€ä½³å®è·µ
```typescript
// è·å–å½“å‰ Unix æ—¶é—´æˆ³ï¼ˆç§’ï¼‰
const now = Math.floor(Date.now() / 1000);

// Unix æ—¶é—´æˆ³è½¬ Date å¯¹è±¡
const date = new Date(timestamp * 1000);

// æ ¼å¼åŒ–æ˜¾ç¤º
const formatted = new Intl.DateTimeFormat('zh-CN', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
  weekday: 'long',
  hour: '2-digit',
  minute: '2-digit',
  timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone
}).format(date);

// å€’æ•°è®¡æ—¶ï¼ˆå·¥ç¨‹ç«™ä¿æŠ¤ç›¾ï¼‰
const remaining = protectionEndTime - now;
const days = Math.floor(remaining / 86400);
const hours = Math.floor((remaining % 86400) / 3600);
const minutes = Math.floor((remaining % 3600) / 60);
```

### Canvas æ€§èƒ½ä¼˜åŒ–
```typescript
// ä½¿ç”¨ç¦»å± Canvas ç¼“å­˜é™æ€å†…å®¹
const offscreenCanvas = document.createElement('canvas');
drawStaticContent(offscreenCanvas.getContext('2d'));

// ä¸» Canvas åªç»˜åˆ¶åŠ¨æ€å†…å®¹
function render() {
  ctx.drawImage(offscreenCanvas, 0, 0);
  drawDynamicMarkers(ctx);
  requestAnimationFrame(render);
}
```

### è™šæ‹Ÿæ»šåŠ¨å®ç°
```typescript
// åªæ¸²æŸ“å¯è§åŒºåŸŸçš„å»ºç­‘å¡ç‰‡
const visibleRange = {
  start: Math.floor(scrollTop / itemHeight),
  end: Math.ceil((scrollTop + viewportHeight) / itemHeight)
};

const visibleBuildings = buildings.slice(
  visibleRange.start,
  visibleRange.end
);
```

### å›ºå®šæ—¶é—´è§„åˆ™å®ç°
```typescript
// å ¡å’å›ºå®šå¼€å¯æ—¶é—´ï¼ˆç¤ºä¾‹ï¼šæ¯å‘¨ä¸€ã€ä¸‰ã€äº” 20:00 UTC+8ï¼‰
export function getNextFortressOpenTime(currentTime: number): number {
  const date = new Date(currentTime * 1000);
  const dayOfWeek = date.getDay(); // 0-6 (å‘¨æ—¥-å‘¨å…­)
  const targetDays = [1, 3, 5]; // å‘¨ä¸€ã€ä¸‰ã€äº”
  const targetHour = 20;
  
  // è®¡ç®—ä¸‹ä¸€ä¸ªç›®æ ‡æ—¥æœŸ
  let daysToAdd = 0;
  for (const targetDay of targetDays) {
    if (dayOfWeek < targetDay) {
      daysToAdd = targetDay - dayOfWeek;
      break;
    }
  }
  
  if (daysToAdd === 0) {
    daysToAdd = 7 - dayOfWeek + targetDays[0];
  }
  
  const nextDate = new Date(date);
  nextDate.setDate(nextDate.getDate() + daysToAdd);
  nextDate.setHours(targetHour, 0, 0, 0);
  
  return Math.floor(nextDate.getTime() / 1000);
}
```

---

## åç»­æ‰©å±•å¯èƒ½æ€§

- ğŸ“Š **æ•°æ®å¯¼å…¥/å¯¼å‡º**ï¼šæ”¯æŒ JSON æ–‡ä»¶å¯¼å…¥å¯¼å‡º
- ğŸ“ˆ **ç»Ÿè®¡é¢æ¿**ï¼šæ˜¾ç¤ºè”ç›Ÿå é¢†æƒ…å†µã€å¼€å¯ç»Ÿè®¡
- ğŸ”” **é€šçŸ¥æé†’**ï¼šå»ºç­‘å³å°†å¼€å¯æ—¶æµè§ˆå™¨é€šçŸ¥ï¼ˆNotification APIï¼‰
- ğŸ—ºï¸ **è·¯å¾„è§„åˆ’**ï¼šè®¡ç®—ä¸¤ä¸ªå»ºç­‘ä¹‹é—´çš„è·ç¦»
- ğŸ‘¥ **å¤šç”¨æˆ·åŒæ­¥**ï¼šé€šè¿‡åç«¯ API åŒæ­¥æ•°æ®
- ğŸ“± **ç§»åŠ¨ç«¯é€‚é…**ï¼šæ”¯æŒæ‰‹æœºå’Œå¹³æ¿è®¾å¤‡
- ğŸ“œ **åˆ†é…å†å²æŸ¥çœ‹**ï¼šæŸ¥çœ‹å ¡å’/è¦å¡çš„å†å²åˆ†é…è®°å½•
- ğŸ¯ **è‡ªåŠ¨åˆ†é…å»ºè®®**ï¼šåŸºäºè”ç›Ÿå®åŠ›è‡ªåŠ¨æ¨èåˆ†é…æ–¹æ¡ˆ
