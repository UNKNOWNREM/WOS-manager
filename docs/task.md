# WOS 建筑管理系统实现任务

## 目标
创建完整的建筑管理系统，左侧建筑列表 (40%) + 右侧互动地图 (60%)，支持联盟管理、时间系统、双向互动、工程站保护盾、堡垒/要塞分派系统。

## 任务清单

### [x] 规划与设计
- [x] 分析详细功能需求文档
- [x] 查看游戏截图理解保护盾机制
- [x] 设计数据结构和类型定义（区分建筑类型）
- [x] 规划组件架构（包含管理员功能）
- [x] 创建详细实现计划

### [ ] 基础架构
- [ ] 创建 `map.html` 页面
- [ ] 创建 `map.tsx` 入口文件
- [ ] 创建 `BuildingManager.tsx` 主页面组件
  - [ ] 实现左侧面板折叠状态管理
  - [ ] 实现折叠按钮和动画
- [ ] 配置 Vite 多页面支持
- [ ] 定义 TypeScript 类型（包含保护盾、分配等新字段）

### [ ] 数据管理
- [ ] 创建数据生成器（区分工程站/堡垒/要塞）
- [ ] 实现固定开启时间规则
- [ ] 实现保护盾时间计算
- [ ] 整合 world JSON 数据的坐标
- [ ] 实现 localStorage Hook
- [ ] 实现数据验证逻辑

### [ ] 左侧建筑列表 (40%)
- [ ] 创建 `BuildingNavBar.tsx` 顶部导航栏
  - [ ] 按建筑类型分类（堡垒/要塞/工程站/全部）
  - [ ] 标签切换功能
- [ ] 创建 `BuildingList.tsx` 容器组件
  - [ ] 实现缩放控制器（75% - 125%）
  - [ ] 缩放影响字体、卡片尺寸、间距
  - [ ] 缩放级别保存到 localStorage
  - [ ] 实现时间自动排序（开启时间快慢）
  - [ ] 排序切换开关
- [ ] 创建 `BuildingCard.tsx`（工程站版本）
  - [ ] 保护盾图标和倒计时
  - [ ] 开启时间编辑
  - [ ] 支持缩放比例调整
- [ ] 创建 `BuildingCard.tsx`（堡垒/要塞版本）
  - [ ] 固定时间显示（不可编辑）
  - [ ] 奖励信息显示
  - [ ] 管理员分配界面
  - [ ] 支持缩放比例调整
- [ ] 创建 `CollapsibleSection.tsx` 折叠分类
- [ ] 实现搜索功能
- [ ] 实现虚拟滚动优化

### [ ] 时间系统
- [ ] 创建 `TimeEditor.tsx`（工程站专用）
- [ ] 实现 Unix 时间戳存储
- [ ] 实现本地时区显示 (`Intl.DateTimeFormat`)
- [ ] 实现快速调整按钮（+1h, +6h, etc）
- [ ] 实现时间验证（开启 < 关闭）
- [ ] 实现保护盾倒计时计算和显示
- [ ] 实现倒计时自动更新

### [ ] 管理员功能（堡垒/要塞）
- [ ] 创建 `AssignmentPanel.tsx` 分配面板
- [ ] 实现管理员权限切换
- [ ] 实现联盟分配功能
- [ ] 实现分配历史记录
- [ ] 实现奖励信息管理
- [ ] 限制非管理员访问

### [ ] 右侧地图 (60%)
- [ ] 创建 `MapView.tsx` 容器组件
- [ ] 实现 `useMapCanvas` Hook
- [ ] 加载 map2.png 背景（或使用纯色）
- [ ] 实现缩放功能 (50%-200%)
- [ ] 实现平移功能（拖拽）
- [ ] 实现重置中心点功能
  - [ ] 一键回到地图中心（600, 600）
  - [ ] 恢复缩放到 100%
- [ ] 创建 `MapLegend.tsx` 图例组件

### [ ] 建筑标记渲染
- [ ] 创建 `mapRenderer.ts` 工具函数
- [ ] 绘制堡垒标记（红色方形 24x24）
- [ ] 绘制要塞标记（紫色六角形 28x28）
- [ ] 绘制工程站标记（蓝色圆形 20x20）
- [ ] 实现保护盾图标绘制（蓝色盾牌）
- [ ] 实现联盟边框颜色（6种）
- [ ] 实现状态动画（保护盾光晕、脉动、闪烁）
- [ ] 实现缩放联盟名称显示（<70% 显示）

### [ ] 双向互动功能
- [ ] 创建 `useInteraction` Hook
- [ ] 列表点击 → 地图定位高亮
- [ ] 地图点击 → 列表滚动高亮
- [ ] 鼠标悬停效果（列表 ↔ 地图）
- [ ] 自动展开折叠分类
- [ ] 实现详情浮窗（3秒自动消失）

### [ ] 样式和UI
- [ ] 创建 `buildingManager.css`
- [ ] 实现深色主题配色
- [ ] 实现玻璃态效果 (glass-panel)
- [ ] 实现保护盾光晕动画
- [ ] 实现动画和过渡效果
- [ ] 实现响应式设计（桌面端）

### [ ] 测试与验证
- [ ] 测试 91 个建筑正确显示（三种类型）
- [ ] 测试工程站保护盾倒计时
- [ ] 测试堡垒/要塞固定时间显示
- [ ] 测试管理员分配系统
- [ ] 测试地图缩放联盟名称显示
- [ ] 测试时间系统（存储、显示、编辑）
- [ ] 测试联盟分配和状态管理
- [ ] 测试双向互动所有场景
- [ ] 测试 localStorage 数据持久化
- [ ] 测试性能（60fps 渲染）
- [ ] 跨浏览器兼容性测试
